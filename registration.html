<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Форма реєстрації</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>
<style>
    .checkbox-lg .form-check-input{
        top: .8rem;
        scale: 1.4;
        margin-right: 0.7rem;
    }

    .checkbox-lg .form-check-label {
        padding-top: 13px;
    }

    .checkbox-xl .form-check-input {
        top: 1.2rem;
        scale: 1.7;
        margin-right: 0.8rem;
        margin-left: -25px;
    }

    .checkbox-xl .form-check-label {
        padding-top: 19px;
        padding-left: 10px;
    }

    .switch-container {
        display: flex;
        flex-wrap: nowrap;
        justify-content: flex-start;
        align-items: center;
        flex-direction: row;
    }

    .switch-container > label {
        padding-bottom: 13px;
        padding-left: 10px;
    }
</style>
<script type="text/javascript">

</script>
<body style="background-color: #ffffff">
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
        integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
        crossorigin="anonymous"></script>

<div class="mt-3 text-center fs-1">Форма реєстрації</div>
<div class="card m-3">
  <div class="card-header">
    <div class="text-center fst-italic text-body-secondary">
        Вашу анкету бачить лише адміністратор бота, який затверджує кандидатів по запитах
    </div>
  </div>
  <div class="card-body">
      <span class="text-danger">*</span> -  Обов'язково для заповнення
  </div>
</div>

<div class="m-3">
    <a id="nameAndLastNameAnchor"></a>
    <label for="nameAndLastName" class="form-label">Ім'я та прізвище</label>
    <span class="text-danger">*</span>
    <input type="text" class="form-control border-2" id="nameAndLastName" required>
    <div class="invalid-feedback">
        Поле повинно бути заповненим
    </div>
</div>

<div class="m-3">
    <a id="servicesAnchor"></a>
    <label for="countrySelect" class="form-label">Ваша послуга</label>
    <span class="text-danger">*</span>
    <select class="form-select border-2" multiple size="5" id="servicesSelect">
        <option value="1">Аніматор</option>
        <option value="2">Фотограф</option>
        <option value="3">Відеограф/Оператор</option>
        <option value="4">Музикант/Вокаліст/Група</option>
        <option value="5">Ді-Джей</option>
        <option value="6">Ведучий/Ведуча</option>
        <option value="7">Декоратор</option>
        <option value="8">Технічний підрядник</option>
        <option value="9">Організатор/Координатор</option>
        <option value="10">Танцор/Танцювальний коллектив</option>
        <option value="11">Шоу номери</option>
        <option value="12">Фокусник</option>
        <option value="13">Аквагрим</option>
        <option value="14">Кейтерінг</option>
        <option value="15">Оренда реквізиту/меблів/обладнання</option>
        <option value="16">Хостес</option>
        <option value="17">Ростові костюми</option>
        <option value="18">Трансфер</option>
        <option value="19">Оренда локації</option>
        <option value="20">Флорист/Декоратор</option>
        <option value="21">Make up</option>
    </select>
    <div class="invalid-feedback">
        Оберіть послугу
    </div>
</div>

<div class="m-3">
    <label for="serviceDescriptionTextArea" class="form-label">Опис послуги</label>
    <textarea class="form-control border-2" id="serviceDescriptionTextArea" rows="2"></textarea>
</div>

<div class="m-3">
    <label for="websiteInput" class="form-label">Посилання на сайт / інстаграм</label>
    <input type="url" class="form-control border-2" id="websiteInput">
</div>

<div class="m-3">
    <a id="averageAnchor"></a>
    <label for="averagePriceInput" class="form-label">Середня вартість послуги</label>
    <span class="text-danger">*</span>
    <input type="text" class="form-control border-2" id="averagePriceInput" required>
    <div class="invalid-feedback">
        Поле повинно бути заповненим
    </div>
</div>

<div class="m-3">
    <a id="countryAnchor"></a>
    <label for="countrySelect" class="form-label">Країна проживання</label>
    <span class="text-danger">*</span>
    <select class="form-select border-2" aria-label="Default select example" id="countrySelect">
        <option>Оберіть країну</option>
        <option value="1">Австрія</option>
        <option value="2">Бельгія</option>
        <option value="3">Болгарія</option>
        <option value="4">Велика Британія</option>
        <option value="5">Греція</option>
        <option value="6">Грузія</option>
        <option value="7">Данія</option>
        <option value="8">Єгипет</option>
        <option value="9">Естонія</option>
        <option value="10">Ізраїль</option>
        <option value="45">Ірландія</option>
        <option value="11">Іспанія</option>
        <option value="12">Італія</option>
        <option value="13">Канада</option>
        <option value="14">Катар</option>
        <option value="15">Кіпр</option>
        <option value="16">Латвія</option>
        <option value="17">Литва</option>
<!--         <option value="18">Ліхтенштейн</option> -->
<!--         <option value="19">Люксембург</option> -->
        <option value="20">Мальта</option>
<!--         <option value="21">Молдова</option> -->
<!--         <option value="22">Монако</option> -->
        <option value="23">Нідерланди</option>
        <option value="24">Німеччина</option>
        <option value="25">Норвегія</option>
        <option value="26">ОАЕ</option>
        <option value="27">Польща</option>
        <option value="28">Португалія</option>
        <option value="29">Румунія</option>
        <option value="30">Саудівська Аравія</option>
<!--         <option value="31">Сербія</option> -->
        <option value="32">Словаччина</option>
<!--         <option value="33">Словенія</option> -->
        <option value="34">США</option>
        <option value="35">Таїланд</option>
        <option value="36">Туреччина</option>
        <option value="37">Угорщина</option>
<!--         <option value="38">Україна</option> -->
        <option value="39">Фінляндія</option>
        <option value="40">Франція</option>
        <option value="41">Хорватія</option>
        <option value="42">Чехія</option>
        <option value="43">Чорногорія</option>
        <option value="44">Швейцарія</option>
        <option value="45">Швеція</option>
    </select>
    <div class="invalid-feedback">
        Оберіть країну
    </div>
</div>

<div class="m-3">
    <a id="cityAnchor"></a>
    <label for="cityInput" class="form-label">Місто проживання</label>
    <span class="text-danger">*</span>
    <input type="text" class="form-control border-2" id="cityInput">
    <div class="invalid-feedback">
        Поле повинно бути заповненим
    </div>
</div>

<div class="form-check form-switch m-3 checkbox-xl switch-container">
    <input class="form-check-input" type="checkbox" role="switch" id="comissionSwitch" style="form-switch-width: 5em">
    <label class="form-check-label fw-bold" for="comissionSwitch">
        Я даю згоду на комісію у 10% від суми виконаного замовлення
    </label>
</div>

<div class="card text-bg-danger m-3" id="validationCard" hidden>
  <div class="card-header text-center">Обов'язкові поля не заповнені</div>
  <div class="card-body">
  </div>
</div>

<div class="card m-3">
  <div class="card-header">
    <div class="text-center text-body-secondary">
        <p>Хочемо звернути увагу, що вашу анкету бачить тільки адміністратор бота, який затверджує кандидатів по запитах.</p>
        <div class="text-center fw-bold text-body-secondary">
            <p>На кожен запит адмін погоджує не більше 4 учасників.</p>
        </div>
        <p>Якщо вас погодив адміністратор - ви отримаєте контакти замовника і далі пишете замовнику напряму (уточніть все, що вам потрібно по запиту та надішліть інформацію по ваших послугах)</p>
    </div>
  </div>
</div>

</body>
<script type="text/javascript">
  let tg = window.Telegram.WebApp
  tg.expand();

  const cityInput = document.getElementById("cityInput");
  const nameAndLastInput = document.getElementById("nameAndLastName");
  const descriptionInput = document.getElementById("serviceDescriptionTextArea");
  const serviceSelect = document.getElementById("servicesSelect");
  const websiteInput = document.getElementById("websiteInput");
  const averagePriceInput = document.getElementById("averagePriceInput");
  const countrySelect = document.getElementById("countrySelect");
  const comissionSwitch = document.getElementById("comissionSwitch");
  const validationCard = document.getElementById("validationCard");

  let nameAndLastValue = '';
  let servicesValues = [];
  let descriptionValue = '';
  let websiteValue = '';
  let averagePriceValue = '';
  let countryValue = '';
  let cityValue = '';

  let isNameAndLastValid = false;
  let isCityValid = false;
  let isServicesValid = false;
  let isAveragePriceValid = false;
  let isCountryValid = false;
  let isComissionValid = false;

  nameAndLastInput.addEventListener("input", event => {
    isNameAndLastValid = nameAndLastInput !== null && event.target.value !== "";
    if (isNameAndLastValid) {
        nameAndLastValue = event.target.value;
    }
    isMainButtonActive();
    constructValidationCard();
  }, false);
  nameAndLastInput.addEventListener("keypress", event => {
    if (event.which == 13) {
        event.preventDefault();
        serviceSelect.focus();
    }
    constructValidationCard();
  }, false);
  nameAndLastInput.addEventListener("focusin", event => {
        nameAndLastInput.classList.remove("is-invalid");
        nameAndLastInput.classList.remove("is-valid");
  }, false);
  nameAndLastInput.addEventListener("focusout", event => {
    if (event.target.value !== "") {
        nameAndLastInput.classList.add("is-valid");
        nameAndLastInput.classList.remove("is-invalid");
    } else {
        nameAndLastInput.classList.add("is-invalid");
        nameAndLastInput.classList.remove("is-valid");
    }
    constructValidationCard();
  }, false);


  serviceSelect.addEventListener("change", event => {
      servicesValues = changeServiceArr(event);
      isServicesValid = !isDefaultServiceWasChosen(event);
      isMainButtonActive();
      constructValidationCard();
  }, false);
  serviceSelect.addEventListener("keypress", event => {
    if (event.which == 13) {
        event.preventDefault();
        descriptionInput.focus();
    }
    constructValidationCard();
  }, false);
  serviceSelect.addEventListener("focusin", event => {
        serviceSelect.classList.remove("is-invalid");
        serviceSelect.classList.remove("is-valid");
  }, false);
  serviceSelect.addEventListener("focusout", event => {
    if (!isDefaultServiceWasChosen(event)) {
        serviceSelect.classList.add("is-valid");
        serviceSelect.classList.remove("is-invalid");
    } else {
        serviceSelect.classList.add("is-invalid");
        serviceSelect.classList.remove("is-valid");
    }
    constructValidationCard();
  }, false);

  descriptionInput.addEventListener("input", event => {
    const isDescriptionValid = descriptionInput !== null && event.target.value !== "";
    if (isDescriptionValid) {
        descriptionValue = event.target.value;
    }
    isMainButtonActive();
    constructValidationCard();
  }, false);
  descriptionInput.addEventListener("keypress", event => {
    if (event.which == 13) {
        event.preventDefault();
        websiteInput.focus();
    }
    constructValidationCard();
  }, false);

  websiteInput.addEventListener("input", event => {
    const isWebsiteValid = websiteInput !== null && event.target.value !== "";
    if (isWebsiteValid) {
        websiteValue = event.target.value;
    }
    isMainButtonActive();
    constructValidationCard();
  }, false);
  websiteInput.addEventListener("keypress", event => {
    if (event.which == 13) {
        event.preventDefault();
        averagePriceInput.focus();
    }
    constructValidationCard();
  }, false);

  averagePriceInput.addEventListener("input", event => {
    isAveragePriceValid = averagePriceInput !== null && event.target.value !== "";
    if (isAveragePriceValid) {
        averagePriceValue = event.target.value;
    }
    isMainButtonActive();
    constructValidationCard();
  }, false);
  averagePriceInput.addEventListener("keypress", event => {
    if (event.which == 13) {
        event.preventDefault();
        countrySelect.focus();
    }
    constructValidationCard();
  }, false);
  averagePriceInput.addEventListener("focusin", event => {
        averagePriceInput.classList.remove("is-invalid");
        averagePriceInput.classList.remove("is-valid");
  }, false);
  averagePriceInput.addEventListener("focusout", event => {
    if (event.target.value !== "") {
        averagePriceInput.classList.add("is-valid");
        averagePriceInput.classList.remove("is-invalid");
    } else {
        averagePriceInput.classList.add("is-invalid");
        averagePriceInput.classList.remove("is-valid");
    }
    constructValidationCard();
  }, false);

  countrySelect.addEventListener("change", event => {
    isCountryValid = countrySelect !== null && event.target.value !== "Оберіть країну";
    if (isCountryValid) {
        countryValue = result = Array.from(event.target.options)
            .filter((element) => element.selected && element.innerText !== "Оберіть країну")
            .map((element) => element.innerText)[0];
    }
    isMainButtonActive();
    constructValidationCard();
  }, false);
  countrySelect.addEventListener("keypress", event => {
    if (event.which == 13) {
        event.preventDefault();
        cityInput.focus();
    }
    constructValidationCard();
  }, false);
  countrySelect.addEventListener("focusin", event => {
        countrySelect.classList.remove("is-invalid");
        countrySelect.classList.remove("is-valid");
  }, false);
  countrySelect.addEventListener("focusout", event => {
    if (event.target.value !== "" && event.target.value !== "Оберіть країну") {
        countrySelect.classList.add("is-valid");
        countrySelect.classList.remove("is-invalid");
    } else {
        countrySelect.classList.add("is-invalid");
        countrySelect.classList.remove("is-valid");
    }
    constructValidationCard();
  }, false);

  cityInput.addEventListener("input", event => {
    isCityValid = cityInput !== null && event.target.value !== "";
    if (isCityValid) {
        cityValue = event.target.value;
    }
    constructValidationCard();
    isMainButtonActive();
  }, false);
  cityInput.addEventListener("keypress", event => {
    if (event.which == 13) {
        event.preventDefault();
        comissionSwitch.focus();
    }
    constructValidationCard();
  }, false);
  cityInput.addEventListener("focusin", event => {
        cityInput.classList.remove("is-invalid");
        cityInput.classList.remove("is-valid");
  }, false);
  cityInput.addEventListener("focusout", event => {
    if (event.target.value !== "") {
        cityInput.classList.add("is-valid");
        cityInput.classList.remove("is-invalid");
    } else {
        cityInput.classList.add("is-invalid");
        cityInput.classList.remove("is-valid");
    }
    constructValidationCard();
  }, false);

  comissionSwitch.addEventListener("input", event => {
    isComissionValid = cityInput !== null && event.target.checked;
    isMainButtonActive();
    constructValidationCard();
    if (isComissionValid) {
        window.scrollTo(0, document.body.scrollHeight);
    }
  }, false);

  function constructValidationCard() {
    if (isShow()) {
        validationCard.hidden = true;
    } else {
        validationCard.hidden = false;
        let body = document.querySelector("div#validationCard > div.card-body");
        let text = '';
        if (!isNameAndLastValid) {
            text += `<p>- Введіть Ім'я та Прізвище: <a href="#nameAndLastNameAnchor" class="link-light link-offset-2 link-underline-opacity-100">[перейти]</a></p>`;
        }
        if (!isServicesValid) {
            text += `<p>- Оберіть послуги: <a href="#servicesAnchor" class="link-light link-offset-2 link-underline-opacity-100">[перейти]</a></p>`;
        }
        if (!isAveragePriceValid) {
            text += `<p>- Вкажіть середню вартість вашіх послуг: <a href="#averageAnchor" class="link-light link-offset-2 link-underline-opacity-100">[перейти]</a></p>`;
        }
        if (!isCountryValid) {
            text += `<p>- Оберіть країну проживання: <a href="#countryAnchor" class="link-light link-offset-2 link-underline-opacity-100">[перейти]</a></p>`;
        }
        if (!isCityValid) {
            text += `<p>- Введіть місто проживання: <a href="#cityAnchor" class="link-light link-offset-2 link-underline-opacity-100">[перейти]</a></p>`;
        }
        if (!isComissionValid) {
            text += `<p>- Ваша анкета буде розглядатись тільки за умови Вашої згоди на коміссію у 10% від суми виконаного замовлення</p>`;
        }
        body.innerHTML = text;
    }
  }

  function insertRequiredField(element, text) {
    const para = document.createElement("p");
    const node = document.createTextNode(text);
    para.appendChild(node);
    element.after(para);
  }

  function isShow() {
    return isCityValid &&
           isNameAndLastValid &&
           isServicesValid &&
           isAveragePriceValid &&
           isCountryValid &&
           isComissionValid;
  }

  function isMainButtonActive() {
    if (isShow()) {
        tg.MainButton.show();
    } else {
        tg.MainButton.hide();
    }
  }

  function changeServiceArr(event) {
    return Array.from(event.target.options)
        .filter((element) => element.selected && element.innerText !== "Оберіть послугу")
        .map((element) => element.innerText);
  }

  function isDefaultServiceWasChosen(event) {
    const hasDefaultArr = Array.from(event.target.options)
        .filter((element) => element.selected && element.innerText == "Оберіть послугу")
        .map((element) => element.innerText);
    return hasDefaultArr.length == 1;
  }

  tg.MainButton.setText('Зареєструватися');
  Telegram.WebApp.onEvent('mainButtonClicked', function() {
      const data = JSON.stringify({
        nameAndLastValue: nameAndLastValue,
        servicesValues: servicesValues,
        descriptionValue: descriptionValue,
        websiteValue: websiteValue,
        averagePriceValue: averagePriceValue,
        countryValue: countryValue,
        cityValue: cityValue,
        type: 3
      });
      tg.sendData(data);
      tg.close();
  });
</script>
</html>
