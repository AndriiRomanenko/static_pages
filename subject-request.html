<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Форма заявки</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>
<style>
    .checkbox-lg .form-check-input{
        top: .8rem;
        scale: 1.4;
        margin-right: 0.7rem;
    }

    .checkbox-lg .form-check-label {
        padding-top: 13px;
    }

    .checkbox-xl .form-check-input {
        top: 1.2rem;
        scale: 1.7;
        margin-right: 0.8rem;
        margin-left: -25px;
    }

    .checkbox-xl .form-check-label {
        padding-top: 19px;
        padding-left: 10px;
    }

    .switch-container {
        display: flex;
        flex-wrap: nowrap;
        justify-content: flex-start;
        align-items: center;
        flex-direction: row;
    }

    .switch-container > label {
        padding-bottom: 13px;
        padding-left: 10px;
    }

</style>
<script type="text/javascript">

</script>
<body style="background-color: #ffffff">
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
        integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
        crossorigin="anonymous"></script>

<div class="mt-3 text-center fs-1">Форма заявки для категорії <br><b>Пасажирські перевезення та посилки</b></div>
<div class="card m-3">
  <div class="card-body">
      <span class="text-danger">*</span> -  Обов'язково для заповнення
  </div>
</div>

<div class="m-3">
    <a id="name"></a>
    <label for="nameInput" class="form-label">Назва транспортної компанії</label>
    <span class="text-danger">*</span>
    <input type="text" class="form-control border-2" id="nameInput">
    <div class="invalid-feedback">
        Поле повинно бути заповненим
    </div>
</div>

<div class="m-3">
    <a id="companyInfo"></a>
    <label for="companyInfoTextArea" class="form-label">Інформація про Вашу компанію</label>
    <span class="text-danger">*</span>
    <input class="form-control border-2" id="companyInfoTextArea" placeholder="посилання на сайт або соцмережі">
    <div class="invalid-feedback">
        Поле повинно бути заповненим
    </div>
</div>

<div class="m-3">
    <a id="countryAnchor"></a>
    <label for="countrySelect" class="form-label">Країни по яких ви працюєте</label>
    <span class="text-danger">*</span>
    <select class="form-select border-2" multiple aria-label="Default select example" id="countrySelect">
        <option>Оберіть країну</option>
        <option value="Австрія">🇦🇹 Австрія</option>
        <option value="Албанія">🇦🇱 Албанія</option>
        <option value="Бельгія">🇧🇪 Бельгія</option>
        <option value="Болгарія">🇧🇬 Болгарія</option>
        <option value="Боснія і Герцоговина">🇧🇦 Боснія і Герцоговина</option>
        <option value="Британія">🏴󠁧󠁢󠁥󠁮󠁧󠁿 Британія</option>
        <option value="Греція">🇬🇷 Греція</option>
        <option value="Грузия">🇬🇪 Грузия</option>
        <option value="Данія">🇩🇰 Данія</option>
        <option value="Естонія">🇪🇪 Естонія</option>
<!--        <option value="Єгипет">Єгипет</option>-->
        <option value="Ірландія">🇮🇪 Ірландія</option>
        <option value="Іспанія">🇪🇸 Іспанія</option>
        <option value="Італія">🇮🇹 Італія</option>
<!--        <option value="Канада">Канада</option>-->
        <option value="Кіпр">🇨🇾 Кіпр</option>
        <option value="Латвія">🇱🇻 Латвія</option>
        <option value="Литва">🇱🇹 Литва</option>
        <option value="Ліхтенштейн">🇱🇮 Ліхтенштейн</option>
        <option value="Люксембург">🇱🇺 Люксембург</option>
        <option value="Мальта">🇲🇹 Мальта</option>
        <option value="Молдова">🇲🇩 Молдова</option>
        <option value="Нідерланди">🇳🇱 Нідерланди</option>
        <option value="Німеччина">🇩🇪 Німеччина</option>
        <option value="Норвегія">🇳🇴 Норвегія</option>
        <option value="ОАЕ">🇦🇪 ОАЕ</option>
        <option value="Польща">🇵🇱 Польща</option>
        <option value="Португалія">🇵🇹 Португалія</option>
        <option value="Північна Македонія">🇲🇰 Північна Македонія</option>
        <option value="Румунія">🇷🇴 Румунія</option>
        <option value="Сербія">🇷🇸 Сербія</option>
        <option value="Словаччина">🇸🇰 Словаччина</option>
        <option value="Словенія">🇸🇮 Словенія</option>
<!--        <option value="США">США</option>-->
        <option value="Таїланд">🇹🇭 Таїланд</option>
        <option value="Туреччина">🇹🇷 Туреччина</option>
        <option value="Угорщина">🇭🇺 Угорщина</option>
        <option value="Фінляндія">🇫🇮 Фінляндія</option>
        <option value="Франція">🇫🇷 Франція</option>
        <option value="Хорватія">🇭🇷 Хорватія</option>
        <option value="Чорногорія">🇲🇪 Чорногорія</option>
        <option value="Чехія">🇨🇿 Чехія</option>
        <option value="Швеція">🇸🇪 Швеція</option>
        <option value="Швейцарія">🇨🇭 Швейцарія</option>
    </select>
    <div class="invalid-feedback">
        Оберіть країну
    </div>
</div>

<div class="card text-bg-danger m-3" id="validationCard">
  <div class="card-header text-center">Обов'язкові поля не заповнені</div>
  <div class="card-body">
      <p>- Введіть назву транспортної компанії:
          <a href="#name" class="link-light link-offset-2 link-underline-opacity-100">[перейти]</a>
      </p>
      <p>- Введіть інформацію про Вашу компанію:
          <a href="#companyInfo" class="link-light link-offset-2 link-underline-opacity-100">[перейти]</a>
      </p>
      <p>- Оберіть країни по яких ви працюєте:
          <a href="#cityAnchor" class="link-light link-offset-2 link-underline-opacity-100">[перейти]</a>
      </p>
  </div>
</div>

</body>
<script type="text/javascript">
  let tg = window.Telegram.WebApp
  tg.expand();

  const nameInput = document.getElementById("nameInput");
  const companyInfoTextArea = document.getElementById("companyInfoTextArea");
  const countrySelect = document.getElementById("countrySelect");
  const validationCard = document.getElementById("validationCard");

  let nameValue = '';
  let companyInfoValue = '';
  let countryValues = [];

  let isNameValid = false;
  let companyInfoValid = false;
  let isCountryValid = false;

  nameInput.addEventListener("input", event => {
    isNameValid = nameInput !== null && event.target.value !== "";
    if (isNameValid) {
        nameValue = event.target.value;
    }
    constructValidationCard();
    isMainButtonActive();
  }, false);
  nameInput.addEventListener("keypress", event => {
    if (event.which == 13) {
        event.preventDefault();
        serviceSelect.focus();
    }
    constructValidationCard();
  }, false);
  nameInput.addEventListener("focusin", event => {
        nameInput.classList.remove("is-invalid");
        nameInput.classList.remove("is-valid");
  }, false);
  nameInput.addEventListener("focusout", event => {
    if (event.target.value !== "") {
        nameInput.classList.add("is-valid");
        nameInput.classList.remove("is-invalid");
    } else {
        nameInput.classList.add("is-invalid");
        nameInput.classList.remove("is-valid");
    }
    constructValidationCard();
  }, false);

  companyInfoTextArea.addEventListener("input", event => {
    companyInfoValid = companyInfoTextArea !== null && event.target.value !== "";
    if (companyInfoValid) {
        companyInfoValue = event.target.value;
    }
    constructValidationCard();
    isMainButtonActive();
  }, false);
  companyInfoTextArea.addEventListener("keypress", event => {
    if (event.which == 13) {
        event.preventDefault();
    }
    constructValidationCard();
  }, false);
  companyInfoTextArea.addEventListener("focusin", event => {
        companyInfoTextArea.classList.remove("is-invalid");
        companyInfoTextArea.classList.remove("is-valid");
  }, false);
  companyInfoTextArea.addEventListener("focusout", event => {
    if (event.target.value !== "") {
        companyInfoTextArea.classList.add("is-valid");
        companyInfoTextArea.classList.remove("is-invalid");
    } else {
        companyInfoTextArea.classList.add("is-invalid");
        companyInfoTextArea.classList.remove("is-valid");
    }
    constructValidationCard();
  }, false);

  countrySelect.addEventListener("change", event => {
    countryValues = changeCountryArr(event);
    isCountryValid = !isDefaultCountryWasChosen(event);
    isMainButtonActive();
    constructValidationCard();
  }, false);
  countrySelect.addEventListener("keypress", event => {
    if (event.which == 13) {
        event.preventDefault();
        cityInput.focus();
    }
    constructValidationCard();
  }, false);
  countrySelect.addEventListener("focusin", event => {
        countrySelect.classList.remove("is-invalid");
        countrySelect.classList.remove("is-valid");
  }, false);
  countrySelect.addEventListener("focusout", event => {
    if (event.target.value !== "" && event.target.value !== "Оберіть країну") {
        countrySelect.classList.add("is-valid");
        countrySelect.classList.remove("is-invalid");
    } else {
        countrySelect.classList.add("is-invalid");
        countrySelect.classList.remove("is-valid");
    }
    constructValidationCard();
  }, false);

  function changeCountryArr(event) {
    return Array.from(event.target.options)
        .filter((element) => element.selected && element.innerText !== "Оберіть країну")
        .map((element) => element.innerText);
  }

  function isDefaultCountryWasChosen(event) {
    const hasDefaultArr = Array.from(event.target.options)
        .filter((element) => element.selected && element.innerText == "Оберіть країну")
        .map((element) => element.innerText);
    return hasDefaultArr.length == 1;
  }

  function constructValidationCard() {
    if (isShow()) {
        validationCard.hidden = true;
    } else {
        validationCard.hidden = false;
        let body = document.querySelector("div#validationCard > div.card-body");
        let text = '';
        if (!isNameValid) {
            text += `<p>- Введіть назву транспортної компанії: <a href="#countryAnchor" class="link-light link-offset-2 link-underline-opacity-100">[перейти]</a></p>`;
        }
        if (!companyInfoValid) {
            text += `<p>- Введіть інформацію про Вашу компанію: <a href="#countryAnchor" class="link-light link-offset-2 link-underline-opacity-100">[перейти]</a></p>`;
        }
        if (!isCountryValid) {
            text += `<p>- Оберіть країни по яких ви працюєте: <a href="#cityAnchor" class="link-light link-offset-2 link-underline-opacity-100">[перейти]</a></p>`;
        }
        body.innerHTML = text;
    }
  }

  function insertRequiredField(element, text) {
    const para = document.createElement("p");
    const node = document.createTextNode(text);
    para.appendChild(node);
    element.after(para);
  }

  function isShow() {
    return isNameValid &&
           companyInfoValid &&
           isCountryValid;
  }

  function isMainButtonActive() {
    if (isShow()) {
        tg.MainButton.show();
    } else {
        tg.MainButton.hide();
    }
  }

  tg.MainButton.setText('Подати заявку');
  Telegram.WebApp.onEvent('mainButtonClicked', function() {
      const data = JSON.stringify({
        nameValue: nameValue,
        companyInfoValue: companyInfoValue,
        countryValues: countryValues,
        type: 7
      });
      tg.sendData(data);
      tg.close();
  });
</script>
</html>
